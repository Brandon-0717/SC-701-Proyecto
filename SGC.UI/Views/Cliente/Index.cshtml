@model IEnumerable<SGC.Abstracciones.Modelos.ModelosDTO.ClienteDto>

<h2>Listado de Clientes</h2>

<a asp-action="Crear" class="btn btn-primary mb-3">Nuevo Cliente</a>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Cédula</th>
            <th>Nombre Completo</th>
            <th>Correo</th>
            <th>Teléfono</th>
            <th>Estado</th>
            <th>Fecha Creación</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
@foreach (var c in Model)
{
    <tr>
        <td>@c.Cedula</td>
        <td>
            @c.Primer_Nombre
            @c.Segundo_Nombre
            @c.Primer_Apellido
            @c.Segundo_Apellido
        </td>
        <td>@c.Correo_Electronico</td>
        <td>@c.Telefono</td>
        <td class="estado" data-id="@c.ESTADOS_FK_CLIENTES"></td>
        <td>@c.Fecha_Creacion?.ToString("dd/MM/yyyy")</td>
        <td>
            <a asp-action="Editar" asp-route-id="@c.CLIENTES_PK" class="btn btn-sm btn-warning">
                Editar
            </a>
            <a asp-action="EliminarClientee" asp-route-id="@c.CLIENTES_PK" class="btn btn-sm btn-danger">
                Eliminar
            </a>
        </td>
    </tr>
}
    </tbody>
</table>

@section Scripts{
<script>
    fetch('@Url.Action("ObtenerClientes")')
        .then(r => r.json())
        .then(data => {
            const tbody = document.querySelector('#tablaClientes tbody');
            data.forEach(c => {
                tbody.innerHTML += `
                    <tr>
                        <td>${c.cedula}</td>
                        <td>${c.primer_Nombre} ${c.primer_Apellido}</td>
                        <td>${c.correo_Electronico}</td>
                        <td>${c.telefono}</td>
                        <td>
                            <a class="btn btn-sm btn-warning" href="/Cliente/Editar/${c.clientes_PK}">Editar</a>
                            <button class="btn btn-sm btn-danger" onclick="eliminar('${c.clientes_PK}')">Eliminar</button>
                        </td>
                    </tr>`;
            });
        });

    function eliminar(id) {
        if (!confirm('¿Desea eliminar el cliente?')) return;

        fetch('@Url.Action("EliminarCliente")', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(id)
        }).then(() => location.reload());
    }
</script>
    <script>
        fetch('/Estado/ListarEstados')
          .then(r => r.json())
          .then(resp => {
            const estados = {};
            resp.data.forEach(e => estados[e.estadoS_PK] = e.nombre_Estado);

            document.querySelectorAll('.estado').forEach(td => {
                const id = td.dataset.id;
                td.innerText = estados[id] || 'N/A';
            });
        });
    </script>
}



